<!DOCTYPE html><html>   
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no" /><title>PickUp Test</title><script type="text/javascript" src="js/phaser.min.js"></script><style>body {padding: 0px;margin: 0px;
	background: black;}</style>  <script>
	var chopper;  
	var crates;
	var mainState = {
		init: function() {
			this.stage.backgroundColor = "#111111";
		},
		preload: function() {
			game.load.image("chopper", "assets/images/player.png");
			game.load.image("crate", "assets/images/basketball.png");},
		create: function() {
			game.physics.startSystem(Phaser.Physics.ARCADE);
			// create the groundvar 
			floorBmp = game.add.bitmapData(480,5);
			floorBmp.ctx.fillStyle="#AAAAAA";
			floorBmp.ctx.fillRect(0,0,480,5);
			this.floor = game.add.sprite(0,315,floorBmp); 
			// Add chopper
			chopper = game.add.sprite(game.world.centerX, game.world.centerY, "chopper");
			chopper.anchor.setTo(0.5);
			chopper.scale.setTo(1,-0.25);
			chopper.collideWorldBounds = true;
			// Add crates
			crates = game.add.group(); 
			crates.enableBody = true;
			for (var i=0; i<5; i++) {
				var c = crates.create(100+ (i*80),290,"crate");
				c.body.bounce.y = 0.5;
				c.body.gravity.y = 300;
				c.collideWorldBounds = true;
				c.name = "crate" + i;
				c.anchor.setTo(0.5);
			}
			crates.enableBodyDebug = true;
			crates.setAll("attached", false);
			// Define Physics
			game.physics.arcade.enable([chopper, this.floor, crates]);
			this.floor.body.immovable = true;
			this.floor.allowGravity - false;
			// setup the viewport camera
			game.world.setBounds(0, 0, 480, 320); 
			game.camera.follow(chopper);
			game.camera.deadzone = new Phaser.Rectangle(0,0,480,320);
			this.cursors = game.input.keyboard.createCursorKeys();
		},
		update: function() {
			game.physics.arcade.collide(chopper, crates, this.chopperHit, null, this);
			game.physics.arcade.collide(crates, this.floor);
			chopper.body.velocity.x = 0;
			chopper.body.velocity.y = 0;
			if (this.cursors.up.isDown){
				chopper.body.velocity.y = -200;
			} else if (this.cursors.down.isDown){
				chopper.body.velocity.y = 200;
			} if (this.cursors.left.isDown){
				chopper.body.velocity.x = -200;
			} else if (this.cursors.right.isDown){
				chopper.body.velocity.x = 200;
			}
			crates.forEach(function(i) {
				if (i.attached) {
					i.x = chopper.x;
					i.y = chopper.y + 30;}
			});},
		render: function() {
			game.debug.body(chopper);
			//game.debug.body(crates);
			game.debug.body(this.floor);
			crates.forEach(function(i) {
				game.debug.body(i);});
		},
		chopperHit: function(body, crateHit) {
			console.log("HIT CRATE = " + crateHit.name);
			crateHit.attached = true;
			crateHit.x = chopper.x;
			crateHit.y = chopper.y+30;
			crateHit.body.gravity.y = 0;
		}
	}
	var game = new Phaser.Game(480, 320, Phaser.AUTO);
	game.state.add("main", mainState);
	game.state.start("main");
</script>   </head>   <body>     </body></html>

